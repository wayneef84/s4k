<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sprunki Private Mixer v1.0</title>
    <style>
        body { background: #0b0b18; color: white; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; padding: 20px; }
        .stage { display: flex; justify-content: center; gap: 12px; padding: 30px; background: rgba(255,255,255,0.03); border-radius: 24px; min-height: 180px; margin: 20px auto; max-width: 900px; border: 1px solid rgba(255,255,255,0.1); }
        .slot { width: 110px; height: 140px; border: 2px dashed #333; border-radius: 18px; display: flex; align-items: center; justify-content: center; position: relative; cursor: pointer; transition: 0.3s; }
        .slot.active { border-style: solid; border-color: #ff0055; background: rgba(255, 0, 85, 0.1); box-shadow: 0 0 20px rgba(255, 0, 85, 0.3); }
        .palette { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 15px; max-width: 950px; margin: 0 auto; padding: 20px; }
        .char-box { background: rgba(255,255,255,0.05); padding: 12px; border-radius: 16px; cursor: pointer; transition: 0.2s; border: 1px solid transparent; }
        .char-box:hover { background: rgba(255,255,255,0.1); transform: translateY(-5px); border-color: #ff0055; }
        .char-img { width: 64px; height: 64px; object-fit: contain; pointer-events: none; }
        .char-label { font-size: 11px; color: #888; display: block; margin-top: 8px; font-weight: 600; text-transform: uppercase; }
        .controls { margin: 30px 0; }
        button { padding: 14px 40px; font-size: 1.1rem; border-radius: 50px; border: none; cursor: pointer; background: #ff0055; color: white; font-weight: bold; margin: 0 10px; }
        .cat-header { text-align: left; grid-column: 1 / -1; font-size: 14px; color: #ff0055; font-weight: bold; margin-top: 25px; border-bottom: 1px solid #222; padding-bottom: 8px; }
    </style>
</head>
<body>
    <h1>Sprunki Private Mixer</h1>
    <div class="stage" id="stage"></div>
    <div class="controls">
        <button id="playBtn" onclick="toggleAll()">â–¶ PLAY</button>
        <button onclick="clearStage()" style="background:#222">ðŸ—‘ RESET</button>
    </div>
    <div id="palette" class="palette"></div>

    <script>
        const ASSET_PATH = "Sprunki/"; 
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const activeSources = {};
        let isPlaying = false;

        const characters = [
            { cat: "Beats", name: "Clukr", sound: "70a511bac6487b9dfb4b9420ad7e86f6.wav", img: "b015564e47af15b260825f7d6af8c643.svg" },
            { cat: "Beats", name: "Fun Bot", sound: "5af077595ce5ece3c73a7cb302394015.wav", img: "4539a15043d037f0b70f71553b30c9cd.svg" },
            { cat: "Beats", name: "Oren", sound: "2ff9e556ae0b3cb4f9e4750dbe9b17d4.wav", img: "5f188f291a010091bd38162b7642e9f4.svg" },
            { cat: "Beats", name: "Raddy", sound: "ae111f7b2abb4ffe113d49e85cadcf7c.wav", img: "d7dc847b001632e8bdf1a390145f10ac.svg" },
            { cat: "Beats", name: "Vineria", sound: "7f08e76918d14fdfa46c4c61728808fc.wav", img: "876921f082afc3d621d511481167abc4.svg" },
            { cat: "Effects", name: "Brud", sound: "ef3c0e50f5c2ac26bfc5700fce42db63.wav", img: "d8d68126b5adc22c77480dd7d6bef466.svg" },
            { cat: "Effects", name: "Garnold", sound: "20dd7bff5b7f33e61e878d6e7b03e48c.wav", img: "9601af13c89996f130ecc71a8eb0febc.svg" },
            { cat: "Effects", name: "Gray", sound: "ac76a6a92f290e7fac145dd9cf8c2b32.wav", img: "2b0d707dc5b6ea94ca34186218819915.svg" },
            { cat: "Effects", name: "OWAKCX", sound: "793e0dde46587175bc6817a4cfd37699.wav", img: "654ee2c380273f6f0a7e263a6d9b6b28.svg" },
            { cat: "Effects", name: "Sky", sound: "c39e54d80f08fd650cc23e04b733a83d.wav", img: "6ee7ba49eae48f5753deb07e0b32199b.svg" },
            { cat: "Melodies", name: "Durple", sound: "a61d4acb6949d64706ec7246eefc7e96.wav", img: "89536b13f86fa5415b0d51716634fa9e.svg" },
            { cat: "Melodies", name: "Sun", sound: "d4864d2ac4176cff6ecffa0064f6a9b8.wav", img: "78203662c512913b3b4a16300cdf194a.svg" },
            { cat: "Melodies", name: "Tree", sound: "d690ea637972fe97870d672dca854c80.wav", img: "1ccf355435482ae38d24bd5b948ef417.svg" },
            { cat: "Melodies", name: "Simon", sound: "5a09fb11b6441a49fc732a93b3b86b00.wav", img: "543119325edb49e5294dd252d196b479.svg" },
            { cat: "Melodies", name: "Tunner", sound: "92ed28220e031b247f5bcce8d0436130.wav", img: "b8faa34280594a1de2cae550193055a1.svg" },
            { cat: "Vocals", name: "Black", sound: "3b725f348a5b90f2190ff1c50709f1cd.wav", img: "08bc20f75cb5b089296dc66c5418096c.svg" },
            { cat: "Vocals", name: "Jevin", sound: "a241da320fdf120b146456732065baa6.wav", img: "a43501db4b83e7684b7e6bbb0f735027.svg" },
            { cat: "Vocals", name: "Computer", sound: "cc85f2be1b1764358cd1ab84455d00a0.wav", img: "a08bbafe2167b837995fd8bf79f5a27f.svg" },
            { cat: "Vocals", name: "Pinki", sound: "be1cb011ce50969caf9511048105f167.wav", img: "4cf8eac32e710942a8ebc364559b1a44.svg" },
            { cat: "Vocals", name: "Wenda", sound: "d3412e9a60ca1e4fb3db49587687ec28.wav", img: "16d88ed40d2540e0196ad94687a163c3.svg" }
        ];

        const stage = document.getElementById('stage');
        for(let i=0; i<7; i++) stage.innerHTML += `<div class="slot" id="slot-${i}" onclick="removeChar(${i})">+</div>`;

        const palette = document.getElementById('palette');
        let lastCat = "";
        characters.forEach(char => {
            if(char.cat !== lastCat) {
                lastCat = char.cat;
                palette.innerHTML += `<div class="cat-header">${lastCat}</div>`;
            }
            palette.innerHTML += `
                <div class="char-box" onclick="addChar('${char.name}', '${char.sound}', '${char.img}')">
                    <img src="${ASSET_PATH}${char.img}" class="char-img">
                    <span class="char-label">${char.name}</span>
                </div>`;
        });

        function toggleAll() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            isPlaying = !isPlaying;
            document.getElementById('playBtn').textContent = isPlaying ? "â¹ STOP" : "â–¶ PLAY";
            if (!isPlaying) audioCtx.suspend(); else audioCtx.resume();
        }

        async function addChar(name, sound, img) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const emptySlot = Array.from(document.querySelectorAll('.slot')).find(s => s.textContent === '+');
            if (!emptySlot) return;

            emptySlot.innerHTML = `<img src="${ASSET_PATH}${img}" style="width:100%; height:100%; object-fit:contain;">`;
            emptySlot.classList.add('active');

            try {
                const response = await fetch(`${ASSET_PATH}${sound}`);
                const arrayBuffer = await response.arrayBuffer();
                const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);
                const source = audioCtx.createBufferSource();
                source.buffer = audioBuffer;
                source.loop = true;
                source.connect(audioCtx.destination);
                source.start(0);
                activeSources[emptySlot.id] = source;
                if (!isPlaying) audioCtx.suspend();
            } catch (e) { console.error("Missing file:", sound); }
        }

        function removeChar(index) {
            const id = `slot-${index}`;
            if (activeSources[id]) { activeSources[id].stop(); delete activeSources[id]; }
            const slot = document.getElementById(id);
            slot.innerHTML = "+"; slot.classList.remove('active');
        }

        function clearStage() {
            for(let i=0; i<7; i++) removeChar(i);
            isPlaying = false;
            document.getElementById('playBtn').textContent = "â–¶ PLAY";
            audioCtx.resume();
        }
    </script>
</body>
</html>